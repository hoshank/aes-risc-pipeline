% =============================================================================

\begin{figure}
\begin{lstlisting}[language=pseudo,style=block]
saes.v4.ks1       rd rs1 rcon : v4.ks1(rd, rs1, rcon)
saes.v4.ks2       rd rs1 rs2  : v4.ks2(rd, rs1, rs2 )
saes.v4.imix      rd rs1      : v4.InvMix(rd, rs1)
saes.v4.encsm     rd rs1 rs2  : v4.Enc(rd, rs1, rs2, mix=1)
saes.v4.encs      rd rs1 rs2  : v4.Enc(rd, rs1, rs2, mix=0)
saes.v4.decsm     rd rs1 rs2  : v4.Dec(rd, rs1, rs2, mix=1)
saes.v4.decs      rd rs1 rs2  : v4.Dec(rd, rs1, rs2, mix=0)
\end{lstlisting}
\caption{
    Instruction mnemonics for variant 4.
    See \REFSEC{sec:pseudo}, \REFFIG{fig:pseudo:v4} for detailed
    descriptions of the pseudo-code functions.
}
\label{fig:mnemonics:v4}
\end{figure}

\REFFIG{fig:mnemonics:v4} shows the mnemonics and pseudo-code functions
for variant 4.
These instructions are designed to take advantage of a 64-bit
datapath.
The AES State is stored in $2$ $64$-bit words: column $0$ in the
lower word of {\tt rs1}, and column $3$ in the upper word of {\tt rs2}.
Hence, the entire AES state can be passed to an instruction, but only
half of the next round state can be written back owing to the
$2$-read-$1$-write constraint of RISC-V.
We note however that by swapping the order of {\tt rs1} and {\tt rs2}
for the {\tt enc*} and {\tt dec*} instructions, we can compute {\em either}
columns $1$ and $2$ or $3$ and $4$ of the next round state, owing to
the nature of the ShiftRows step.
The {\tt ks*} instructions allow the a new round key to be computed
in $3$ instructions.

A single encryption round using this variant requires
$2$ load-double instructions to fetch the round key,
$2$ {\tt xor} instructions to add the round key
and
$2$ {\tt saes.v4.encs[m]} instructions to compute SubBytes, ShiftRows
and MixColumns.

This proposal is similar to \cite{SPARC:16} in how it utilises
a 64-bit datapath.
It sources only two general purpose registers however (rather than $3$),
making it less demanding to implement in the context of the wider
system.
The addition of an extra source register would save only $2$ instructions
per cycle by allowing AddRoundKey to be included.

% =============================================================================
