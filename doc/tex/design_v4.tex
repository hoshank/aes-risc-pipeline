% =============================================================================

\subsubsection{ISE interface}

% TODO: instruction definition(s)

% -----------------------------------------------------------------------------

\subsubsection{ISE implementation}

\begin{lstlisting}[language=pseudo,style=block]
round_consts.8 = [0x01, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x80, 0x1b, 0x36]

saes64.ks1(rs1,enc_rcon):      // KeySchedule: SubBytes, Rotate, Round Const
    temp.32   = rs1.32[1]
    rcon      = 0x0
    if(enc_rcon != 0xA):
        temp.32 = ROTR32(temp.32, 8)
        rcon    = round_consts.8[enc_rcon]
    temp.8[i] = AESSBox(temp.8[i])  for i=0..3
    temp.8[0] = temp.8[i  ] ^ rcon
    rd.64     = {temp.32, temp.32}

saes64.ks2(rs1,rs2):           // KeySchedule: XOR
    rd.32[0]  = rs1.32[1] ^ rs2.32[0]
    rd.32[1]  = rs1.32[1] ^ rs2.32[0] ^ rs2.32[1]

saes64.enc(rs1, rs2, mix, hi): // SubBytes, ShiftRows, MixColumns
    t1.128    = AESShiftRows(rs2 || rs1)
    t2.64     = t1.64[1] if hi else t1.64[0]
    t3.8[i]   = AESSBox(t2.8[i]) for i=0..7
    rd.32[0]  = AESMixColumn(t3.32[0]) if mix else t3.32[0]
    rd.32[1]  = AESMixColumn(t3.32[1]) if mix else t3.32[1]

saes64.dec(rs1, rs2, mix, hi): // InvSubBytes, InvShiftRows, InvMixColumns
    t1.128    = InvAESShiftRows(rs2 || rs1)
    t2.64     = t1.64[1] if hi else t1.64[0]
    t3.8[i]   = InvAESSBox(t2.8[i]) for i=0..7
    rd.32[0]  = InvAESMixColumn(t3.32[0]) if mix else t3.32[0]
    rd.32[1]  = InvAESMixColumn(t3.32[1]) if mix else t3.32[1]

saes64.imix(rs1):              // Inverse MixColumns
    rd.32[0]  = InvAESMixColumn(rs1.32[0])
    rd.32[1]  = InvAESMixColumn(rs1.32[1])
\end{lstlisting}

% TODO: micro-architecture diagram

% =============================================================================
